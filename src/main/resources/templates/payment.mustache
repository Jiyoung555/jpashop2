<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
<!--TO DO : head에 최신버전 그걸로 수정하기-->

<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"></script>
<!--아임포트 라이브러리 추가-->

<input name="price" placeholder="금액 입력하시오">
<button id="payment_btn" type="button">결제하기</button>


<script>
$('#payment_btn').click(function () {

    IMP.init('imp06376564');//나의 가맹점 식별코드

    var money = $('input[name="price"]').val();
    console.log(money);

    IMP.request_pay({
        pg : 'inicis', // 이니시스 (version 1.1.0부터 지원)
        pay_method : 'card',
        merchant_uid : 'merchant_' + new Date().getTime(),
        name : '주문명: 결제테스트',
        amount : money, //amount : 1000
        buyer_email : 'wnsekd23@hanmail.net',
        buyer_name : '홍지영',
        buyer_tel : '010-2126-9260',
        buyer_addr : '서울특별시 강남구 삼성동',
        buyer_postcode : '123-456'

    }, function(rsp) {
        if ( rsp.success ) { //rsp : 성공해서 온 동적결과 response
            var msg = '결제가 완료되었습니다.';
            msg += '\n고유ID : ' + rsp.imp_uid;
            msg += '\n상점 거래ID : ' + rsp.merchant_uid;
            msg += '\n결제 금액 : ' + rsp.paid_amount + '원';
            msg += '\n카드 승인번호 : ' + rsp.apply_num;

            var data = {
                amount : rsp.paid_amount
            }; //순수 js 객체

            $.ajax({ //내 DB에도 남기기
                type: "POST",
                url: "/payment/price",
                data: JSON.stringify(data), //순수 js 객체가 아닌, 문자열로 데이터 보내겟다
                contentType: "application/json"
            });


        } else {
            var msg = '결제에 실패하였습니다.';
            msg += '\n에러내용 : ' + rsp.error_msg;
        }

        alert(msg);
        window.location.href='login';
        //window.location.href='/payments/status/all'; //alert창 확인 후 이동할 url 설정
    });

});


</script>